/*!
 * jQuery Nestedy - A nested fields creator
 *
 * Licensed under The MIT License
 *
 * @version        0.1.0
 * @author         Washington Botelho
 * @documentation  wbotelhos.com/nestedy
 *
 */
;(function(b){var a={init:function(c){return this.each(function(){this.opt=b.extend({},b.fn.nestedy.defaults,c);a._instances.call(this);a._saveData.call(this,this.model);a._bindAdd.call(this);a._bindRemove.call(this);b(this).data({settings:this.opt,nestedy:true});});},_add:function(){var c=this.model.clone(true);if(this.opt.add&&!a.__execute.call(this,this.opt.add,c)){return false;}if(this.opt.excludes&&this.opt.excludes.length>0){a._exclude.call(this,c);}if(this.opt.template){c.removeAttr("id");}a._clear.call(this,c);this.content.append(c);a._reorder.call(this);if(this.opt.focus){a._focus.call(this,c);}},_bindAdd:function(){var c=this;c.addButton.on("click.nestedy",function(){a._add.call(c);});},_bindRemove:function(){var c=this;c.content.on("click.nestedy",".nestedy-remove",function(){a._remove.call(c,this);});},_clear:function(c){b(c).find(":input").each(function(){if(this.type==="text"||this.type==="textarea"){this.value="";}else{if(this.type==="select-one"||this.type==="select-multiple"){b(this).find("option").removeAttr("selected").first().prop("selected",true);}else{if(this.type==="checkbox"||this.type==="radio"){b(this).removeAttr("checked").prop("checked",false);}}}});},_rename:function(f,c,d){var e=b(f).data(d)||f[d];partner="$1"+c+"$2";return e.replace(this.opt[d+"x"],partner).replace(/\$1(\d)\$2/,"$1");},__execute:function(e,c){var d=e.call(this,c);return d||d===undefined;},_exclude:function(e){for(var d=0;d<this.opt.excludes.length;d++){var c=this.opt.excludes[d],f=c.charAt(0);if(f!="#"&&f!="."){c=":input["+c+"]";}e.find(c).remove();}},_focus:function(c){var d=(this.opt.focus==":last"&&c)||this.content.find(this.opt.model+this.opt.focus);if(d){d.find(":input:visible:first").focus();}},_remove:function(c){var d=b(c).closest(this.opt.model);if(this.opt.remove&&!a.__execute.call(this,this.opt.remove,d)){return false;}d.remove();a._reorder.call(this);if(this.opt.focus){a._focus.call(this);}},_reorder:function(){var c=this;b(c).find(c.opt.model).each(function(d){b(this).find(":input").each(function(){this.name=a._rename.call(c,this,d,"name");this.id=a._rename.call(c,this,d,"id");});});},_saveData:function(c){b(c).find(":input").each(function(){b(this).data({id:this.id,name:this.name});});},_instances:function(){var c=b(this);this.content=c.find(this.opt.content);this.addButton=c.find(this.opt.addButton);this.model=(this.opt.template?b("body").find(this.opt.template):c.find(this.opt.model)).first();},isNumber:function(c){return !isNaN(parseFloat(c))&&isFinite(c);},add:function(c){if(c&&!a.isNumber(c)){b.error("The parameter '"+c+"' passed on add function is not a number!");}return b(this).each(function(){for(var d=0;d<(c||1);d++){a._add.call(this);}});},remove:function(d){var c=d||"last";if(a.isNumber(d)){c="eq("+(Number(--c))+")";}else{if(c!="first"&&c!="last"){b.error("The parameter '"+d+"' passed on remove function is invalid!");}}return b(this).each(function(){var e=b(this).find(this.opt.removeButton+":"+c);a._remove.call(this,e);});}};b.fn.nestedy=function(c){if(a[c]){return a[c].apply(this,Array.prototype.slice.call(arguments,1));}else{if(typeof c==="object"||!c){return a.init.apply(this,arguments);}else{b.error("Method "+c+" does not exist!");}}};b.fn.nestedy.defaults={add:undefined,addButton:".nestedy-add",content:".nestedy",excludes:['id$="id"','name$="id"','name$="id\\]"'],focus:":last",idx:/(_)\d(_)/,model:".nestedy-item",namex:/(\[)\d(\])/,remove:undefined,removeButton:".nestedy-remove",template:undefined};})(jQuery);
